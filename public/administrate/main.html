<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>하잇</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/administrate/js/sidebar.js" defer></script>
    <script src="/administrate/js/profilebar.js" defer></script>
    <script src="/administrate/js/title.js" defer></script>
    <script src="/administrate/js/cardList.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="/administrate/css/sidebar.css">
    <link rel="stylesheet" href="/administrate/css/main.css">
    <link rel="stylesheet" href="/administrate/css/profilebar.css">
    <link rel="stylesheet" href="/administrate/css/title.css">
    <link rel="stylesheet" href="/administrate/css/font.css">
    <link rel="stylesheet" href="/administrate/css/cardList.css">
</head>

<style>
    .chart-container {
        min-width: 1400px;
        max-width: 1600px;
        height: 450px;
        margin: auto;
        overflow: hidden;
        position: relative;
        cursor: grab;
        display: flex;
    }
    
    .y-axis-labels {
        width: 50px;
        text-align: right;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding-right: 10px;
        color: red;
    }
    
    .chart-wrapper {
        width: 2000px;
        height: 450px;
        display: flex;
        align-items: center;
        cursor: grab;
    }
    
    canvas {
        width: 100%;
        height: 450px;
        display: block;
    }
    
    #tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 14px;
        display: none;
        pointer-events: none;
    }
</style>

<body>
    <div id="main">
        <div id="sidebar"></div>
        <div class="content-container">
            <div id="profilebar"></div>
            <div id="title"></div>
            <div id="cardList"></div>
            
            <div class="chart-container">
                <div class="y-axis-labels" id="yLabels"></div>
                <div class="chart-wrapper">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
            <div id="tooltip"></div>
        </div>        
    </div>
</body>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const ctx = document.getElementById('myChart').getContext('2d');
        const chartWrapper = document.querySelector(".chart-wrapper");
        let isDragging = false;
        let startX, scrollPosition = 0;
        let currentStartIndex = 23;

        function generateLast30Days() {
            let dates = [];
            let values = [];
            let today = new Date();
            for (let i = 29; i >= 0; i--) {
                let pastDate = new Date();
                pastDate.setDate(today.getDate() - i);
                let formattedDate = pastDate.toISOString().split('T')[0];
                dates.push(formattedDate);
                values.push(Math.floor(Math.random() * 100) + 1);
            }
            return { dates, values };
        }

        const { dates, values } = generateLast30Days();
        const data = {
            labels: dates,
            datasets: [{
                label: '개수 변화',
                data: values,
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderWidth: 2,
                fill: true,
                pointRadius: 5,
                pointHoverRadius: 8
            }]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: { color: 'blue', autoSkip: false },
                        grid: { display: false },
                        min: dates[23],
                        max: dates[30]
                    },
                    y: {
                        ticks: { color: 'red' },
                        grid: { color: 'rgba(200, 200, 200, 0.5)', borderDash: [5, 5] }
                    }
                },
                plugins: {
                    tooltip: { enabled: false }
                }
            }
        };

        const myChart = new Chart(ctx, config);

        chartWrapper.addEventListener("mousedown", (e) => {
            isDragging = true;
            startX = e.clientX;
        });

        document.addEventListener("mouseup", () => {
            isDragging = false;
        });

        document.addEventListener("mousemove", (e) => {
            if (!isDragging) return;
            const moveX = e.clientX - startX;
            if (Math.abs(moveX) > 200) {
                if (moveX > 0 && currentStartIndex > 0) {
                    currentStartIndex--;
                } else if (moveX < 0 && currentStartIndex < dates.length - 7) {
                    currentStartIndex++;
                }
                myChart.options.scales.x.min = dates[currentStartIndex];
                myChart.options.scales.x.max = dates[currentStartIndex + 6];
                myChart.update();
                startX = e.clientX;
            }
        });
    });
</script>
</html>